<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">

<#assign className = table.className>   
<#assign classNameFirstLower = className?uncap_first>   
<#assign classNameLowerCase = className?lower_case>  
<#macro namespace>${classNameFirstLower}.</#macro>

<properties>
	
	<!-- 用于select查询公用抽取的列 -->
	<entry key="<@namespace/>columns">
	    <![CDATA[
        <#list table.columns as column>${column.sqlName} <#if column_has_next>,</#if></#list>
	    ]]>
	</entry>
	
    <entry key="<@namespace/>insert" >
    <![CDATA[
        INSERT INTO ${table.sqlName} (
        <#list table.columns as column>
        	${column.sqlName} <#if column_has_next>,</#if>
        </#list>
        ) VALUES (
        <#list table.columns as column>
        	:${column.columnNameLower} <#if column_has_next>,</#if>
        </#list>        
        )
    ]]>
    </insert>

    <entry key="<@namespace/>update" >
    <![CDATA[
        UPDATE ${table.sqlName} SET
	        <#list table.notPkColumns as column>
	        ${column.sqlName} = :${column.columnNameLower} <#if column_has_next>,</#if>
	        </#list>
        WHERE 
        	<#list table.compositeIdColumns as column>
	        ${column.sqlName} = :${column.columnNameLower} <#if column_has_next> AND </#if>
	        </#list>
    ]]>
    </entry>

    <entry key="<@namespace/>delete">
    <![CDATA[
        DELETE FROM ${table.sqlName} WHERE
        <#list table.compositeIdColumns as column>
        ${column.sqlName} = :${column.columnNameLower} <#if column_has_next> AND </#if>
		</#list>
    ]]>
    </entry>
    
    <entry key="<@namespace/>getById" resultMap="RM.${className}">
	    SELECT <#noparse><#include</entry>#noparse> "<@namespace/>column">
	    <![CDATA[
	        FROM ${table.sqlName} 
	        WHERE 
				<#list table.compositeIdColumns as column>
		        ${column.sqlName} = :${column.columnNameLower} <#if column_has_next> AND </#if>
		        </#list>
	    ]]>
    </entry>

	<entry key="<@namespace/>findPage.where">
		where 1=1
       <#list table.columns as column>
	       <#if column.isDateTimeColumn>
	       
	       <#if ${column.columnNameLower}Begin? >
	            and ${column.sqlName} >= ${column.columnNameLower}Begin
	       </#if>
	       <#if ${column.columnNameLower}End? >
	            and ${column.sqlName} &lt;= :${column.columnNameLower}End
	       </#if>
		   <#else>
	       <#if ${column.columnNameLower}? >
	            and ${column.sqlName} = :${column.columnNameLower}
	       </#if>
	       
		   </#if>
       </#list>
	</entry>
	 
    <entry key="<@namespace/>findPage.count">
        SELECT count(*) FROM ${table.sqlName} <#noparse><#include "</#noparse><@namespace/>findPage.where">    
    </entry>
    
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    <entry key="<@namespace/>findPage">
    	SELECT <#noparse><#include</#noparse> "<@namespace/>column"> FROM ${table.sqlName} 
		<include refid=""/> <#noparse><#include</#noparse> "<@namespace/>findPage.where">
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </entry>

    <#list table.columns as column>
    <#if column.unique && !column.pk>
    <entry key="<@namespace/>getBy${column.columnName}" >
	    SELECT <#noparse><#include</#noparse> "<@namespace/>column">
	    <![CDATA[
	        FROM ${table.sqlName} WHERE ${column.sqlName} = :${column.columnNameLower}
	    ]]>
    </entry>
    
    </#if>
	</#list>
		
</properties>